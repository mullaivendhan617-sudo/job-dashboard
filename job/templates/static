<!DOCTYPE html>
<html>
<head>
<title>SQL Server Job Monitoring Dashboard</title>
<meta http-equiv="refresh" content="60">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background: #f4f7fb; }
.header-section { display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:25px; }
.header-section img { height:45px; object-fit:contain; }
h3 { font-weight:700; color:#003366; margin:0; }
.filter-bar { display:flex; justify-content:center; gap:12px; margin-bottom:20px; }
.filter-bar input { width:260px; border-radius:8px; }
table { background:white; border-radius:8px; overflow:hidden; font-size:14px; }
td:nth-child(2), th:nth-child(2) { min-width:170px; }
tr:nth-child(even) { background:#eef5ff; }
</style>
</head>

<body class="p-4">

<div class="header-section">
    <img src="/static/Lyca_Mobile_Logo.jpg" alt="Lyca Logo">
    <h3>SQL Server Job Monitoring Dashboard</h3>
</div>

<div class="filter-bar">
    <input type="text" id="jobSearch" class="form-control" placeholder="Search Job Name...">
    <input type="text" id="statusSearch" class="form-control" placeholder="Search Status...">
    <input type="text" id="freqSearch" class="form-control" placeholder="Search Frequency...">
</div>

<table class="table table-bordered table-hover" id="jobTable">
<tr class="table-primary">
  <th>Job Name</th>
  <th>Last Run</th>
  <th>Status</th>
  <th>Frequency</th>
  <th>Schedule</th>
  <th>Details</th>
</tr>

{% for j in jobs %}
<tr>
<td>{{ j.JobName }}</td>
<td>{{ j.LastRun }}</td>

<td>
{% if j.CurrentStatus == 'Succeeded' %}
  ✅ Success
{% elif j.CurrentStatus == 'Failed' %}
  ❌ Failed
{% elif j.CurrentStatus == 'Running' %}
  ⏳ Running
{% endif %}
</td>

<td>{{ j.Frequency }}</td>
<td>{{ j.ScheduleDescription }}</td>
<td>{{ j.Message }}</td>
</tr>
{% endfor %}
</table>

<script>
function filterTable() {
    let job = jobSearch.value.toLowerCase();
    let status = statusSearch.value.toLowerCase();
    let freq = freqSearch.value.toLowerCase();
    document.querySelectorAll("#jobTable tr").forEach((r,i)=>{
        if(i===0) return;
        r.style.display = (r.cells[0].innerText.toLowerCase().includes(job) &&
                           r.cells[2].innerText.toLowerCase().includes(status) &&
                           r.cells[3].innerText.toLowerCase().includes(freq)) ? "" : "none";
    });
}
jobSearch.onkeyup = statusSearch.onkeyup = freqSearch.onkeyup = filterTable;
</script>

</body>
</html>
